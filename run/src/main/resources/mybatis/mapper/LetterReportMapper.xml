<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xr.run.dao.daily.LetterReportMapper">
    <select id="list" resultType="com.xr.run.entity.daily.LetterReport" parameterType="com.xr.run.entity.daily.LetterReport">
select lr.lid,lr.letterid,lr.ltime,lr.lComplainantName, lr.lDeptId, lr.lPostId,(select s.`name` from sys_staff s where s.sid=lr.lPersonBeReported)  lpersonbereported, (select s.mechanism_name from sys_mechanism s where s.mid=lr.lPbrDeptId) lPbrDeptId,(select s.pname from sys_ppost s where s.pid=lr.lPbrPostId) lPbrPostId,lr.lcontent,lr.lsynopsis,lr.lSupervisionComments,lr.lSupervisionCommentsTime,lr.lSupervisionResutl,lr.lSupervisionResultTime,lr.lResult,lr.lResultTime,lr.lCreateTime,lr.lCreateName,lr.lStatus,lr.lDisciplinaryComments,lr.lDisciplinaryTime,lr.lLeadersComments,lr.lLeadersTime,lr.puni from daily_letterreport lr where  lr.lStatus!=-1
        <if test="mid != null and !mid.equals('')">
            and lr.lmid=#{mid}</if>
        <if test="lStatus != null and !lStatus.equals('')">
            and lr.lStatus=#{lStatus}</if>
        <if test="lCreateid != null and !lCreateid.equals('')">
            and lr.lCreateid=#{lCreateid}</if>
 order by lr.lCreateTime desc
    </select>
    <insert id="addletter">
        insert into daily_letterreport(letterid,ltime,lComplainantName,lDeptId,lPostId,lpersonbereported,lPbrDeptId,lPbrPostId,lcontent,lCreateTime,lCreateName,lCreateid,lStatus,puni) values(#{letterId},#{lTime},#{lComplainantName},#{lDeptId},#{lPostId},#{lPersonBeReported},#{lPbrDeptId},#{lPbrPostId},#{lContent},#{lCreateTime},#{lCreateName},#{lCreateId},#{lStatus},#{puni})
    </insert>
    <update id="deletter" parameterType="Integer">
        update  daily_letterreport set lStatus=-1 where lid=#{lid}
    </update>
    <select id="findbyName" resultType="com.xr.run.entity.daily.LetterReport" parameterType="com.xr.run.entity.daily.LetterReport">
        select lr.lid,lr.letterid,lr.ltime,lr.lComplainantName, lr.lDeptId, lr.lPostId,(select s.`name` from sys_staff s where s.sid=lr.lPersonBeReported)  lpersonbereported, (select s.mechanism_name from sys_mechanism s where s.mid=lr.lPbrDeptId) lPbrDeptId,(select s.pname from sys_ppost s where s.pid=lr.lPbrPostId) lPbrPostId,lr.lcontent,lr.lsynopsis,lr.lSupervisionComments,lr.lSupervisionCommentsTime,lr.lSupervisionResutl,lr.lSupervisionResultTime,lr.lResult,lr.lResultTime,lr.lCreateTime,lr.lCreateName,lr.lStatus,lr.lDisciplinaryComments,lr.lDisciplinaryTime,lr.lLeadersComments,lr.lLeadersTime,lr.puni from daily_letterreport lr where lr.lStatus!=-1
        <if test="mid != null and !mid.equals('')">
            and lr.lmid=#{mid}</if>
        <if test="lStatus != null and !lStatus.equals('')">
            and lr.lStatus=#{lStatus}</if>
        <if test="lCreateid != null and !lCreateid.equals('')">
            and lr.lCreateid=#{lCreateid}</if>
        <if test="lComplainantName != null and !lComplainantName.equals('')">
        AND lComplainantName like #{lComplainantName}</if>
        <if test="lPersonBeReported != null and !lPersonBeReported.equals('')">
            AND (select s.`name` from sys_staff s where s.sid=lr.lPersonBeReported) like #{lPersonBeReported}
    </if>
        order by lr.lCreateTime desc
    </select>
    <!--纪检监察员编写内容摘要提交审核-->
    <update id="shbc" parameterType="com.xr.run.entity.daily.LetterReport">
        update daily_letterreport set lsynopsis=#{lSynopsis},lStatus=2 where lid=#{lid}
    </update>
    <select id="listLetterByid" resultType="com.xr.run.entity.daily.LetterReport" parameterType="Integer">
select lr.lid,lr.letterid,lr.ltime,lr.lComplainantName, lr.lDeptId, lr.lPostId,lpersonbereported,lr.lPbrDeptId,lr.lPbrPostId,lr.lcontent,lr.lsynopsis,lr.lCreateTime,lr.lCreateName,lr.lStatus from daily_letterreport lr where lr.lCreateid=#{lid}
    </select>
    <!--用户提交审核-->
    <update id="tjshme" parameterType="Integer" >
        update daily_letterreport set lStatus=1 where lid=#{lid}
    </update>
    <!--转办部门-->
    <update id="turndept" parameterType="com.xr.run.entity.daily.LetterReport">
        update daily_letterreport set lStatus=3,lmid=#{mid} where lid=#{lid}
    </update>
    <!--监察科自办-->
    <update id="kezhangbc" parameterType="com.xr.run.entity.daily.LetterReport">
  update daily_letterreport set lStatus=4,lSupervisionResutl=#{lSupervisionResutl},lSupervisionResultTime=#{lSupervisionResultTime},lSupervisionComments=#{lSupervisionComments},lSupervisionCommentsTime=#{lSupervisionCommentsTime}  where lid=#{lid}
       </update>
    <!--转办部门处理结果-->
    <update id="deptbc" parameterType="com.xr.run.entity.daily.LetterReport">
         update daily_letterreport set lStatus=4,lresult=#{lResult},lResultTime=#{lResultTime} where lid=#{lid}
    </update>
    <!--局领导提交审核意见-->
    <update id="leaderbc" parameterType="com.xr.run.entity.daily.LetterReport">
      update daily_letterreport set lLeadersComments=#{lLeadersComments},lLeadersTime=#{lLeadersTime} where lid=#{lid}
    </update>
    <!--纪检组长提交审核意见-->
    <update id="zzbc" parameterType="com.xr.run.entity.daily.LetterReport">
         update daily_letterreport set lDisciplinaryComments=#{lDisciplinaryComments},lDisciplinaryTime=#{lDisciplinaryTime} where lid=#{lid}
    </update>
    <!--用户更新-->
    <update id="bjbcmethod" parameterType="com.xr.run.entity.daily.LetterReport">
          update daily_letterreport set lcontent=#{lContent} where lid=#{lid}
    </update>
    <!--根据用户真实姓名查询部门和单位-->
    <resultMap id="dp" type="com.xr.run.entity.daily.DeptUnit">
        <result column="mechanism_name" property="mname"></result>
        <result column="pname" property="pname"></result>
    </resultMap>
    <select id="finddp" parameterType="String" resultMap="dp"  >
        select DISTINCT s.`name`, sme.mechanism_name,p.pname from sys_staff s,sys_ppost p,sys_mechanism sme where sme.mid=s.mid and s.ppid= p.pid and s.`name`=#{nickname}
    </select>
</mapper>